#!/usr/bin/env bash
set -e

# Test with operator olm installation
echo "======================================================"
echo "Cleanup Argo CD installation"
echo "======================================================"
echo "Remove Argo CD instance"
kubectl delete ArgoCD argocd -n argocd
kubectl delete crd appprojects.argoproj.io
kubectl delete crd applications.argoproj.io
kubectl delete crd workflowtemplates.argoproj.io
kubectl delete crd workflows.argoproj.io
echo "Remove Operator"
kubectl delete -f guides/k8s/olm/subscription.yaml
kubectl delete csvs --all -n argocd
kubectl delete crd argocds.argoproj.io
kubectl delete -f build/_output/guides/${ENVIRONMENT}/k8s/olm/catalog-source.yaml
kubectl delete -f build/_output/guides/${ENVIRONMENT}/k8s/olm/operator-group.yaml
kubectl delete -f build/_output/guides/${ENVIRONMENT}/k8s/olm/namespace.yaml
